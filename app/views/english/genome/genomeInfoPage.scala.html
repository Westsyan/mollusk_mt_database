@import models.Tables.GenomeRow
@(row: GenomeRow)(implicit session: Session)
@english.home.main(row.geneid + " - Browser") {
    <link rel="stylesheet" media="screen" href="@routes.Assets.versioned("mscroll/css/lz_index.css")">

    <div id="content" class="container">
        <h1 class="title"><a href="@routes.GenomeController.browserPage()">Genome</a> - @row.geneid</h1>
        <div class="line"></div>

        <div class="box">
            <h4 class="area">
                <div class="area_img">
                    <i class="fa fa-minus"></i>
                </div>
                <span class="area_title" data-id="1">Basic</span>

            </h4>
            <div class="picture_list">

                <table class="table table-striped table-hover table-bordered" style="table-layout: fixed;
                    float: left;
                    word-wrap: break-word">
                    <tbody>
                        <tr>
                            <th rowspan="13" style="width: 50%;
                                vertical-align: middle;
                                text-align: center" >
                                <img src="/mollusk/utils/getGemomeImg?id=@row.id"
                                style='color: cornflowerblue;
                                    margin: 0 auto;
                                    max-height: 300px'/>
                            </th>
                            <th>ID</th>
                            <td>@row.geneid</td>
                        </tr>
                        <tr>
                            <th>Organism</th>
                            <td>@row.organism</td>
                        </tr>
                        <tr>
                            <th>Phylumn</th>
                            <td>@row.phylum</td>
                        </tr>
                        <tr>
                            <th>Class</th>
                            <td>@row.classes</td>
                        </tr>
                        <tr>
                            <th>Order</th>
                            <td>@row.order</td>
                        </tr>
                        <tr>
                            <th>Family</th>
                            <td>@row.family</td>
                        </tr>
                        <tr>
                            <th>Genus</th>
                            <td>@row.genus</td>
                        </tr>

                        <tr>
                            <th>Length</th>
                            <td>
                            @row.length
                            </td>
                        </tr>
                        <tr>
                            <th>AT%</th>
                            <td>
                            @row.at
                            </td>
                        </tr>
                        <tr>
                            <th>Download</th>
                            <td>
                                <div><a target='_blank' href='/mollusk/download/downloadSelect?id=@row.id&fa=gb'>
                                    <i class='fa fa-download'></i> @{row.geneid}.gb </a></div>
                                <div><a target='_blank' href='/mollusk/download/downloadSelect?id=@row.id&fa=cds'>
                                    <i class='fa fa-download'></i> @{row.geneid}.cds</a></div>
                                <div><a target='_blank' href='/mollusk/download/downloadSelect?id=@row.id&fa=pep'>
                                    <i class='fa fa-download'></i> @{row.geneid}.pep </a></div>
                                <div><a target='_blank' href='/mollusk/download/downloadSelect?id=@row.id&fa=gene'>
                                    <i class='fa fa-download'></i> @{row.geneid}.gene </a></div>
                                <div><a target='_blank' href='/mollusk/download/downloadSelect?id=@row.id&fa=genome'>
                                    <i class='fa fa-download'></i> @{row.geneid}.genome </a></div>

                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div class="box">
            <h4 class="area" >
                <div class="area_img">
                    <i class="fa fa-minus"></i>
                </div>
                <span class="area_title" data-id="1">Geographical distribution</span>
            </h4>
            <div class="picture_list">
                <div id="worldmap" style="margin: 0 auto;
                    width: 100%;
                    margin-bottom: 10px;
                    display: none"></div>
                <table class="table table-hover table-striped table-bordered">
                    <tbody>
                        <tr>
                            <th style="width: 20%;">Geographical position</th>
                            <td>@row.position</td>
                        </tr>
                        <tr>
                            <th>Collection by</th>
                            <td>@row.collected</td>
                        </tr>
                        <tr>
                            <th>Locality （GPS）</th>
                            <td>@row.locality</td>
                        </tr>
                        <tr>
                            <th>Description</th>
                            <td>@row.description</td>
                        </tr>
                        <tr>
                            <th>Citation</th>
                            <td>@row.citation</td>
                        </tr>
                        <tr>
                            <th>Link</th>
                            <td>@for(link <- row.link.split(" ")){
                             <div><a href="@link.drop(2)" target="_blank">@link</a></div>
                            }
                            </td>
                        </tr>

                    </tbody>
                </table>

            </div>
        </div>

        <div class="box" id="ref">
            <h4 class="area">
                <div class="area_img">
                    <i class="fa fa-minus"></i>
                </div>
                <span class="area_title" data-id="1">Pubmed</span>

            </h4>
            <div class="picture_list">

                <table class="display table table-bordered" id="refTable" data-pagination="true" data-search="true"
                data-toolbar="#toolbar" data-page-list="[10, 25, 50, 100, all]" data-search-align="left" data-multiple-search="true">
                    <thead>
                        <tr>
                            <th>Title</th>
                            <th>Journal</th>
                            <th>Author</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><a href="@row.pubmed" target="_blank">@row.title</a></td>
                            <td>@row.journal</td>
                            <td>@row.author</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div class="box">
            <h4 class="area" id="genomeb" onclick="reloadGbrowser()">
                <div class="area_img">
                    <i class="fa fa-minus"></i>
                </div>
                <span class="area_title" data-id="1">Genome Browser</span>
            </h4>
            <div class="picture_list">
                <iframe style="border: 1px solid rgb(80, 80, 80);" src="http://210.22.121.250:20795/?data=my_data/MODB/@{
                    row.geneid
                }/data&loc=&tracks=DNA,Annotation&tracklist=0&nav=1&overview=0"
                height="250" width="898px" name="jbrowse_iframe" id="iframe">
                </iframe>

            </div>
        </div>


        <div class="box">
            <h4 class="area">
                <div class="area_img">
                    <i class="fa fa-minus"></i>
                </div>
                <span class="area_title" data-id="1"> Gene </span>
            </h4>
            <div class="picture_list">
                <table class="table table-striped table-hover table-bordered" id="table" style="table-layout: fixed;
                    word-wrap: break-word" data-pagination="true" data-search="true"
                data-toolbar="#toolbar" data-page-list="[10, 25, 50, 100, all]" data-search-align="left" data-multiple-search="true">

                </table>

            </div>
        </div>

    </div>

    <script src="@routes.Assets.versioned("mscroll/js/mscroll.js")" type="text/javascript"></script>
    <script src="@routes.Assets.versioned("Highmaps-6.1.0/highmaps.js")" type="text/javascript"></script>
    <script src="@routes.Assets.versioned("Highmaps-6.1.0/exporting.js")" type="text/javascript"></script>
    <script src="@routes.Assets.versioned("Highmaps-6.1.0/data.js")" type="text/javascript"></script>
    <script>
            let sars = {};
            let other = [];
            $(function () {
                $("#table").bootstrapTable({
                    columns: [{
                        field: "geneid",
                        title: "GeneID",
                        sortable: true,
                        formatter: function (i, v) {
                            return "<a href='/US/mollusk/genome/genePage?id=" + v.id + "' target='_blank'>" + v.geneid + "</a>"
                        }
                    }, {
                        field: "start",
                        title: "Start position",
                        sortable: true
                    }, {
                        field: "end",
                        title: "End position",
                        sortable: true
                    }, {
                        field: "strand",
                        title: "Strand",
                        sortable: true
                    }]
                })

                $.ajax({
                    url: "/US/mollusk/genome/getAllGeneById?id=" + @row.id,
                    type: "post",
                    success: function (data) {
                        $("#table").bootstrapTable("load", data)
                    }
                })


                // 地图路径，参考 https://img.hcharts.cn/mapdata/index.html
                var map = getMapName('map'),
                        url = '/assets/Highmaps-6.1.0/world.js';

                // 动态加载地图数据文件并生成图表。
                loadScript(url, function () {
                    // 生成随机数据
                    var mapdata = Highcharts.maps[map.path],
                            data = [];


                    function drawMap(datas) {
                        Highcharts.each(datas, function (v, i) {
                            data.push({
                                'hc-key': v.key,
                                value: v.num
                            })
                        })

                        // 初始化图表
                        $('#worldmap').highcharts('Map', {
                            title: {
                                text: map.cname || map.name
                            },
                            subtitle: {
                                text: ''
                            },
                            mapNavigation: {
                                enabled: true,
                                enableMouseWheelZoom: false,
                                buttonOptions: {
                                    verticalAlign: 'bottom'
                                }
                            },
                            credits: {
                                enabled: false
                            },
                            colorAxis: {
                                min: 0,
                                stops: [
                                    [0, '#EFEFFF'],
                                    [0.5, Highcharts.getOptions().colors[0]],
                                    [1, Highcharts.Color(Highcharts.getOptions().colors[0]).brighten(-0.5).get()]
                                ]
                            },
                            series: [{
                                data: data,
                                mapData: mapdata,
                                joinBy: 'hc-key',
                                name: '物种数',
                                allowPointSelect: true,
                                cursor: 'pointer',
                                states: {
                                    hover: {
                                        color: '#a4edba'
                                    },
                                    select: {
                                        color: 'orange',
                                        borderColor: 'black',
                                        dashStyle: 'shortdot'
                                    }
                                },
                                tooltip: {
                                    useHTML: true,
                                    headerFormat: '',
                                    pointFormat: ' {point.properties.name}',
                                    footerFormat: ''
                                }
                            }]
                        });
                    }

                    $.ajax({
                        url: "/US/mollusk/genome/getWorldPostion?id=" + @row.id,
                        type: "post",
                        success: function (datas) {
                            drawMap(datas)
                        }
                    })
                });
            });


    </script>


}